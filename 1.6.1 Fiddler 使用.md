# Fiddler 使用


>windows 系统

## 1.使用Fiddler进行抓包

要使用Fiddler进行抓包，首先需要确保Capture Traffic是开启的（安装后是默认开启的），

勾选File->Capture Traffic，也可以直接点击Fiddler界面左下角的图标开启和关闭抓包。

#：顺序号，按照抓包的顺序从1递增

- Result：HTTP状态码　　　　　　

- Protocol：请求使用的协议，如HTTP/HTTPS/FTP等

- HOST：请求地址的主机名或域名

- URL：请求资源的位置

- Body：请求大小

- Caching：请求的缓存过期时间或者缓存控制值

- Content-Type：请求响应的类型

- Process：发送此请求的进程ID

- Comments：备注 

- Custom：自定义值

## Insepector

每个Fiddler抓取到的数据包都会在该列表中展示，点击具体的一条数据包可以在右侧菜单点击Insepector查看详细内容。

主要分为请求（即客户端发出的数据）和响应（服务器返回的数据）两部分

## https == http + TSL 或 SSL

捕获 https 会话需要配置，tools--->options--->https

选中 "Decrypt HTTPS traffic", 首次会让安装证书的，都是 “yes”,同时选中 “ignore server certificate error” 忽略证书错误，

旁边还有一个 action，可以 Reset All certificates

安装后，测试，打开浏览器，访问 https://www.baidu.com 看能否捕获到 https 的百度请求


- 拓展：

  - 1.清除C:\Users\Administrator\AppData\Roaming\Microsoft\Crypto\RSA 目录下所有文件（首次安装fiddler请忽略）

  - 2.清除电脑上的根证书，WIN+R快捷键，输入：certmgr.msc， 然后回车，查找所有fiddler证书，然后删除。（首次安装fiddler请忽略）

  - 3.查看 windows 本地安装的证书
    - 3.1 tools--->options--->https--->action--->open window certificate mannger
    - 3.2 或者，命令行，输入 certmgr.msc
    - 就可以找到安装的证书叫 “DO_NOT_TRUST_FiddlerRoot-CE”


## 查看请求参数

webform 中参看请求你携带的参数
    

- 参考：[Fiddler抓取https设置详解（图文）](https://www.cnblogs.com/joshua317/p/8670923.html)

- get 提交的数据有大小限制（浏览器对URL长度有限制），get也不安全
- post 提交数据大小无限制



## http 状态码

- 1xx
- 2xx
- 3xx
- 4xx
- 5xx


## User-agent

>作用就是浏览器告诉服务器，客户端使用的操作系统 及版本，浏览器及版本等

fiddler: 修改 user-agent ,伪装客户端

rules---->user-agent ,选择 iphone 6



## referer
>主要用来让服务器判断来源页面，
有时候 referer也被用作防盗链

## 设置断点，修改 http 请求

- rules---> automatic breakpoint----> before request 或者使用 F11 快捷键

打开浏览器，输入网址后，打开 inspectors 面板， 使用 Raw 选项卡，这时候可以把请求的URL 修改，host 也可以修改，单击绿色的 “run to completion”即可

## 设置断点，修改 http 相应
- rules---> automatic breakpoint----> after request 

## 伪造 referer

- rules---> automatic breakpoint----> before request

打开 一个网络图片，这时候fiddler 会拦截请求 在 raw 选项上修改 http 请求，添加一个 Refere:www.test.com , run to completion



## http 缓存

>通过修改时间判断缓存的新鲜度

web 服务器收到http 请求后，将服务器的文档修改时间（Last-Modified）跟 http 请求的 Header 中的 If-Modified-Since 相比较

如果时间是一样的，说明缓存是最新的，服务器将发送 304（Not Modified） 状态码给浏览器客户端，告诉客户端直接使用缓存的版本


- 不使用缓存
  - Pragma: no-cache; 是 http 1.0中定义的；
  - Cache-Control: no-cache 和 Pragma: no-cache

- 公有缓存和私有缓存
  - Cache-Control:public 公有缓存；
  - Cache-Control:private 私有缓存；




## fiddler autoResponder  在线调试 js 文件


拖拽一个 请求 到 AutoResponder 

在 rule editor 中第二个下拉选择 find a file ..., 选择本地的 js 文件路径

选中 enable rules, 选中 “Unmatched request passthrough”,

单击 save

这样只需要修改本机上的文件，然后刷新浏览器 就能看到效果

- 这样的方法也可以替换某一个网站的图片



## fiddler script

- 可以修改 http 请求的 host 地址
- 可以修改 http 请求的 Header
-  可以修改 http 请求的 body

```
 static function OnBeforeRequest(oSession: Session) {
        // Sample Rule: Color ASPX requests in RED
        // if (oSession.uriContains(".aspx")) {	oSession["ui-color"] = "red";	}

        // Sample Rule: Flag POSTs to fiddler2.com in italics
        // if (oSession.HostnameIs("www.fiddler2.com") && oSession.HTTPMethodIs("POST")) {	oSession["ui-italic"] = "yup";	}

        // Sample Rule: Break requests for URLs containing "/sandbox/"
        // if (oSession.uriContains("/sandbox/")) {
        //     oSession.oFlags["x-breakrequest"] = "yup";	// Existence of the x-breakrequest flag creates a breakpoint; the "yup" value is unimportant.
        // }
}
```

## 修改 http 相应
代码应放在 `OnBeforeResponse(oSession: Session)` 方法下

```
static function OnBeforeResponse(oSession: Session) {
        if (m_Hide304s && oSession.responseCode == 304) {}
}
```



## cookie


- cookie 劫持攻击

登录示例

- 浏览器植入 cookie ,

在 fiddler script 中 OnBeforeRequest 函数中添加请求的cookie

```
if (oSession.uriContains("douban.com")) {
 var sCookie = "";
 oSession.oRequest["Cookie"] = sCookie;
}
```



## fiddler 手机抓包

配置 tools--->options--->Connections

选中 “allow remote computers to connect”

手机上设置代理服务器，手动，电脑的 IP ，代理的端口号

手机上测试，浏览器输入一个网址即可，抓取 http 请求，不需要安装证书，直接就可以抓到

如果需要捕获https,手机需要安装证书（tools--->options--->https--action中选择导出证书“export root certificate to desktop”）




## 参考
- [fiddler 官网](https://www.telerik.com/fiddler)
- [download-fiddler](https://www.telerik.com/download/fiddler)
