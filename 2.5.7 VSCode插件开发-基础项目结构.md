# 2.5.7 VSCode插件开发-基础项目结构

## 1.项目搭建

- 微软官方的脚手架 [vscode-generator-code](https://github.com/Microsoft/vscode-generator-code) 来生成项目结构

## 2.脚手架的使用

```
安装脚手架:

npm install -g yo generator-code

然后cd到你的工作目录，运行 yo code

根据向导一步步选择即可
```

## 3.项目结构

```
```

>项目结构其实很简单，主要是清单文件`package.json`以及`extension.js`这个插件入口文件：

- package.json部分关键内容如下（已省略其它）

```
{
	// 扩展的激活事件
	"activationEvents": [
		"onCommand:extension.sayHello"
	],
	// 入口文件
	"main": "./extension",
	// 贡献点，vscode插件大部分功能配置都在这里
	"contributes": {
		"commands": [
			{
				"command": "extension.sayHello",
				"title": "Hello World"
			}
		]
	}
}
```

- `src/extension.js` 内容如下：

```
const vscode = require('vscode');

/**
 * 插件被激活时触发，所有代码总入口
 * @param {*} context 插件上下文
 */
exports.activate = function(context) {
	console.log('恭喜，您的扩展"vscode-plugin-demo"已被激活！');
	// 注册命令
	let disposable = vscode.commands.registerCommand('extension.helloWorld', function () {
		// The code you place here will be executed every time your command is executed

		// Display a message box to the user
		vscode.window.showInformationMessage('Hello World!');
	});

	context.subscriptions.push(disposable);
};

/**
 * 插件被释放时触发
 */
exports.deactivate = function() {
	console.log('您的扩展"vscode-plugin-demo"已被释放！')
};
```


## 4.解读
承如上述代码：

- main定义了整个插件的主入口；
- 我们在contributes.commands里面注册了一个名为extension.sayHello的命令，并在src/extension.js中去实现了它（弹出一个Hello World的提示）；
- 但是仅仅这样还不够，命令虽然定义了，但是vscode还不知道啥时候去执行它，还需要在activationEvents添加上onCommand:extension.sayHello用来告诉vscode，当用户执行了这个命令操作时去执行前面我们定义的内容；
- 除了onCommand之外，还有onView、onUri、onLanguage等等，具体我们后面会详细讲到。

## 5.运行调试
>默认情况下，工程已经帮我们配置好了调试相关参数（有兴趣的可以查看.vscode/launch.json文件的写法），
只需要到调试面板选中要调试的项目(仅仅是第一次需要，后续会自动记住上次调试的项目)，
然后按下F5就会弹出一个新的vscode窗口：

这个新窗口已经加载了我们的插件，窗口标题会注明`扩展开发宿主`，  
对于只有单显示器的同学来说，很容易写着写着就忘了哪个是主窗口，哪个是新窗口，所以可以通过这个来区分。

>然后按下`Ctrl+Shift+P`，输入`HelloWorld` 执行对应命令，你发现右下角弹出了 `HelloWorld` 的提示

## 6.添加右键菜单和快捷键

上面由于我们只是注册了命令，没有添加菜单或快捷键，调用不方便，所以我们现在添加一下。

- 打开package.json，按照下述方式添加：

```
{
	"contributes": {
		"commands": [
			{
				"command": "extension.sayHello",
				"title": "Hello World"
			}
		],
		// 快捷键绑定
		"keybindings": [
			{
				"command": "extension.sayHello",
				"key": "ctrl+f10",
				"mac": "cmd+f10",
				"when": "editorTextFocus"
			}
		],
		// 设置菜单
		"menus": {
			"editor/context": [
				{
					"when": "editorFocus",
					"command": "extension.sayHello",
					"group": "navigation"
				}
			]
		}
	}
}
```

然后重新运行插件，在编辑器的右键可以看到菜单

## 7.关于重新加载

如果修改了扩展代码，想重新加载的话，可以直接在新窗口上按下`Ctrl+R`来快速重新加载，也可以先停止，然后再按`F5`。

## 8.关于开发语言
vscode插件可以使用TypeScript来编写（官方推荐），也可以使用JavaScript，，不过使用哪种方式，能实现的功能都是一样的。


## 参考
- [VSCode插件开发全攻略（二）HelloWord](http://blog.haoji.me/vscode-plugin-hello-world.html)
